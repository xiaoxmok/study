$(function(){login()||(location.href="login.html"),$(".switch label").on("click",function(){var e=$(this).attr("class"),t=$(this).siblings("input");"switch_on"==e?(t.attr("checked",!1),t.attr("dataName","n"),$(this).attr("class","switch_off")):(t.attr("checked",!0),t.attr("dataName","y"),$(this).attr("class","switch_on"))});var a,t=getCookie("token"),c=api.getUser(t);$.ajax({"type":"GET","url":url+"/api/v1/school-region/index?school_id="+c.school_id+"&lang="+i18nLanguage+"&city="+getCookie("city"),"dataType":"json","async":!1,"success":function(e){if(200===e.code){var t=e.data;$("#schoolSearch").html(""),t.forEach(function(e,t){var a='<option value="'+e.id+'">'+e.name+"</option>";$("#schoolSearch").append(a)})}},"error":function(){}}),api.getAddressList(getCookie("userId")).forEach(function(e,t){"y"===e.is_default&&(a=e.address)}),$(".defalutAddress span").html(a),$('.sex[value="'+c.sex+'"]').attr("checked","true"),$('.role[value="'+c.type+'"]').attr("checked","true"),$(".name").val(c.name),$(".no").val(c.school_no),$("#schoolSearch").find('option[value="'+c.school_region_id+'"]').attr("selected",!0),"y"===c.order_email_notify?($("#check-1").attr("checked",!0),$("#check-1").attr("dataName","y"),$("#check-1").siblings("label").attr("class","switch_on")):($("#check-1").attr("checked",!1),$("#check-1").attr("dataName","n"),$("#check-1").siblings("label").attr("class","switch_off")),"y"===c.order_sms_notify?($("#check-2").attr("checked",!0),$("#check-2").attr("dataName","y"),$("#check-2").siblings("label").attr("class","switch_on")):($("#check-2").attr("checked",!1),$("#check-2").attr("dataName","n"),$("#check-2").siblings("label").attr("class","switch_off")),$(".submit").click(function(){var e={"token":t,"id":c.id,"name":$(".name").val(),"sex":$('.sex[name="sex"]:checked').val(),"type":$('.role[name="role"]:checked').val(),"school_region_id":$("#schoolSearch").children("option:selected").val(),"order_email_notify":$("#check-1").attr("dataName"),"order_sms_notify":$("#check-2").attr("dataName"),"school_no":$(".no").val(),"default_address":$(".defalutAddress span").html()};$.ajax({"type":"POST","url":url+"/api/v1/user/update","dataType":"json","data":e,"success":function(e){200===e.code?($(".error").html("修改成功。"),setTimeout(function(){location.href="center.html"},1e3)):$(".error").html(e.msg)},"error":function(e,t,a){}})})});