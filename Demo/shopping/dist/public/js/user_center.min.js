$(function(){login()||(location.href="login.html");var e,n,a=getCookie("token"),t=api.getUser(a);"zh"===getCookie("userLanguage")?("male"===t.sex?e="男":"female"===t.sex&&(e="女"),"student"===t.type?n="学生":"teacher"===t.type?n="老师":"staff"===t.type&&(n="教职员工")):"en"===getCookie("userLanguage")&&("male"===t.sex?e="male":"female"===t.sex&&(e="female"),"student"===t.type?n="student":"teacher"===t.type?n="teacher":"staff"===t.type&&(n="staff")),$(".userName .person .name").html(t.name),$(".userName .person .sex").html(e),$(".userName .person .role").html(n),$(".userName .person .no em").html(t.school_no),$(".userName .person .email em").html(t.email),$(".userName .person .phone em").html(t.phone),$(".userName .person .address em").html(t.address);var s=api.getSchool(t.id,i18nLanguage);function i(){$(".pcOrder").html(""),$(".mOrder li").html(""),$.ajax({"type":"GET","url":"/"+urlL+"public/json/orders.json?page_size=10&page_num=1","dataType":"json","beforeSend":function(e){var n=(new Date).getTime(),t=$.md5(a+"shop"+n);e.setRequestHeader("token",a),e.setRequestHeader("time",n),e.setRequestHeader("secure_token",t)},"success":function(e){if("0"===e.success)if(0<e.data.length){e.data.forEach(function(e,n){var t='<tr>\n                <td>\n                    <div class="img"><img src="'+e.pic+'" alt=""></div>\n                    <div class="con">\n                        <p>订单号：'+e.no+"</p>\n                        <span>下单时间："+e.time+"</span>\n                    </div>\n                </td>\n                <td>"+e.status+"</td>\n                <td>￥"+e.price+'</td>\n                <td class="operate">\n                    <a href="./ordersDetail.html?id='+e.no+'">查看详情</a>\n                    <a href="./invoice.html">开具发票</a>\n                    <a href="./returns.html?id='+e.no+'">退换货</a>\n                </td>\n            </tr>';$(".pcOrder").append(t);var a='<li>\n                    <div class="up">\n                        <div class="img"><img src="'+e.pic+'" alt=""></div>\n                        <div class="con">\n                            <p>订单号：'+e.no+"</p>\n                            <span>下单时间："+e.time+'</span>\n                        </div>\n                        <div class="status">订单状态：'+e.status+'</div>\n                    </div>\n                    <div class="down">\n                        <a href="./ordersDetail.html">查看详情</a>\n                        <a href="./invoice.html">开具发票</a>\n                        <a href="./returns.html?id='+e.no+'">退换货</a>\n                    </div>\n                </li>';$(".mOrder ul").append(a)})}else{$(".pcOrder").append('<tr>\n                <td colspan="5">\n                    <p>暂无数据</p>\n                </td>\n            </tr>');var n="<li>\n                    <div>\n                        <p>暂无数据</p>\n                    </div>\n                </li>";$(".mOrder ul").append(n)}else{$(".pcOrder").append('<tr>\n                <td colspan="5">\n                    <p>获取失败</p>\n                </td>\n            </tr>');n="<li>\n                    <div>\n                        <p>获取失败</p>\n                    </div>\n                </li>";$(".mOrder li").append(n)}},"error":function(e,n,t){}})}$(".school .img img").attr("src",s.logo_info),$(".school .con .title").html(s.name),$(".school .con span").html(s.description),i(),$(".orderNav li").click(function(){var e=$(this).index();switch($(".list").hide().eq(e).show(),$(".orderNav li").removeClass("active"),$(this).addClass("active"),e){case 0:i();break;case 1:$(".collect ul").html(""),$.ajax({"type":"GET","url":"/"+urlL+"public/json/collect.json?page_size=10&page_num=1","dataType":"json","beforeSend":function(e){var n=(new Date).getTime(),t=$.md5(a+"shop"+n);e.setRequestHeader("token",a),e.setRequestHeader("time",n),e.setRequestHeader("secure_token",t)},"success":function(e){if("0"===e.success)if(0<e.data.length)e.data.forEach(function(e,n){var t='<li>\n                    <img src="'+e.pic+'" alt="">\n                    <div class="con">\n                        <p class="Title">'+e.name+'</p>\n                        <p class="description">'+e.detail+'</p>\n                        <p class="price"><span>常规价格：</span><del>￥'+e.origin_price+'</del></p>\n                        <p class="price"><span>学校优惠价：</span><em>￥'+e.edu_price+"</em></p>\n                    </div>\n                </li>";$(".collect ul").append(t)});else{var n="<li>\n                    <p>无数据</p>\n                </li>";$(".collect ul").append(n)}else n="<li>\n                    <p>无数据</p>\n                </li>",$(".collect ul").append(n)},"error":function(e,n,t){}})}}),$(".signOut").click(function(){var e={"token":a};delAllCookie(),$.ajax({"type":"POST","url":url+"/api/v1/user/logout","dataType":"json","data":e,"success":function(e){200===e.code&&(delAllCookie(),setTimeout(function(){location.href="index.html"},1e3))},"error":function(e,n,t){}})})});