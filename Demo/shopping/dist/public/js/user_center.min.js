$(function(){login()||(location.href="login.html");var e,r,n,a=getCookie("token"),t=api.getUser(a);"zh"===getCookie("userLanguage")?("male"===t.sex?e="男":"female"===t.sex&&(e="女"),"student"===t.type?r="学生":"teacher"===t.type?r="老师":"staff"===t.type&&(r="教职员工")):"en"===getCookie("userLanguage")&&("male"===t.sex?e="male":"female"===t.sex&&(e="female"),"student"===t.type?r="student":"teacher"===t.type?r="teacher":"staff"===t.type&&(r="staff")),$(".userName .person .name").html(t.name),$(".userName .person .sex").html(e),$(".userName .person .role").html(r),$(".userName .person .no em").html(t.school_no),$(".userName .person .email em").html(t.email),$(".userName .person .phone em").html(t.phone),api.getAddressList(getCookie("userId")).forEach(function(e,r){"y"===e.is_default&&(n=e.address)}),$(".userName .person .address em").html(n);var o=api.getSchool(t.school_info.id,i18nLanguage);$(".school .img img").attr("src",o.logo_info.url),$(".school .con .title").html(o.name),$(".school .con span").html(o.description);var i={"waitingForPay":"待支付","paying":"支付中","paid":"已支付","waitingForInstall":"待安装","installing":"安装中","installed":"已安装","dispatching":"配送中","dispatched":"已配送","waitingForSign":"待签收","signed":"已签收","canceled":"已取消","returned":"已退货","exchanged":"已换货","waitingForReturn":"待退货"};function d(e){$(".pcOrder").html(""),$(".mOrder ul").html("");if($(".pcOrder").append("<tr>\n                <th>订单号</th>\n                <th>订单状态</th>\n                <th>订单金额</th>\n                <th>操作</th>\n            </tr>"),200===e.code)if(0<e.data.length){e.data.forEach(function(e,r){var n;"waitingForPay"===e.status?n='              <a href="./ordersDetail.html?id='+e.order_no+'">查看详情</a>\n                    <a href="./payment.html?orderNo='+e.order_no+'&center=true">去支付</a>\n                    <a href="javascript:;" id="cancel" data-name="'+e.order_no+'">取消订单</a>\n':"paying"===e.status?n='              <a href="./ordersDetail.html?id='+e.order_no+'">查看详情</a>\n':"paid"===e.status?n='              <a href="./ordersDetail.html?id='+e.order_no+'">查看详情</a>\n                    <a href="./invoice.html?order_no='+e.order_no+'">开具发票</a>\n                    <a href="./returns.html?id='+e.order_no+'">退换货</a>':"waitingForInstall"===e.status?n='              <a href="./ordersDetail.html?id='+e.order_no+'">查看详情</a>\n                    <a href="./invoice.html?order_no='+e.order_no+'">开具发票</a>\n                    <a href="./returns.html?id='+e.order_no+'">退换货</a>\n':"installing"===e.status?n='              <a href="./ordersDetail.html?id='+e.order_no+'">查看详情</a>\n                    <a href="./invoice.html?order_no='+e.order_no+'">开具发票</a>\n                    <a href="./returns.html?id='+e.order_no+'">退换货</a>\n':"installed"===e.status?n='              <a href="./ordersDetail.html?id='+e.order_no+'">查看详情</a>\n                    <a href="./invoice.html?order_no='+e.order_no+'">开具发票</a>\n                    <a href="./returns.html?id='+e.order_no+'">退换货</a>\n':"dispatching"===e.status?n='              <a href="./ordersDetail.html?id='+e.order_no+'">查看详情</a>\n                    <a href="./invoice.html?order_no='+e.order_no+'">开具发票</a>\n                    <a href="./returns.html?id='+e.order_no+'">退换货</a>\n':"waitingForSign"===e.status?n='              <a href="./ordersDetail.html?id='+e.order_no+'">查看详情</a>\n                    <a href="./invoice.html?order_no='+e.order_no+'">开具发票</a>\n                    <a href="./returns.html?id='+e.no+'">退换货</a>\n':"signed"===e.status?n='              <a href="./ordersDetail.html?id='+e.order_no+'">查看详情</a>\n                    <a href="./invoice.html?order_no='+e.order_no+'">开具发票</a>\n                    <a href="./returns.html?id='+e.order_no+'">退换货</a>\n':"canceled"===e.status?n='              <a href="./ordersDetail.html?id='+e.order_no+'">查看详情</a>\n':"waitingForReturn"===e.status?n='              <a href="./ordersDetail.html?id='+e.order_no+'">查看详情</a>\n':"returned"===e.status?n='              <a href="./ordersDetail.html?id='+e.order_no+'">查看详情</a>\n':"exchanged"===e.status&&(n='              <a href="./ordersDetail.html?id='+e.order_no+'">查看详情</a>\n                    <a href="./invoice.html?order_no='+e.order_no+'">开具发票</a>\n                    <a href="./returns.html?id='+e.order_no+'">退换货</a>\n');var a='<tr>\n                <td>\n                    <div class="img"><img src="'+e.goods_cover_url+'" alt=""><p>共'+e.goods_sum+'件</p></div>\n                    <div class="con">\n                        <p>订单号：'+e.order_no+"</p>\n                        <span>下单时间："+e.created_at+"</span>\n                    </div>\n                </td>\n                <td>"+i[e.status]+"</td>\n                <td>￥"+e.price+'</td>\n                <td class="operate">\n'+n+"                </td>\n            </tr>";$(".pcOrder").append(a);var t='<li>\n                    <div class="up">\n                        <div class="img"><img src="'+e.goods_cover_url+'" alt=""><p>共'+e.goods_sum+'件</p></div>\n                        <div class="con">\n                            <p>订单号：'+e.order_no+"</p>\n                            <span>下单时间："+e.created_at+'</span>\n                        </div>\n                        <div class="status">订单状态：'+i[e.status]+'</div>\n                    </div>\n                    <div class="down">\n'+n+"                    </div>\n                </li>";$(".mOrder ul").append(t)})}else{$(".pcOrder").append('<tr>\n                <td colspan="5">\n                    <p>暂无数据</p>\n                </td>\n            </tr>');var r="<li>\n                    <div>\n                        <p>暂无数据</p>\n                    </div>\n                </li>";$(".mOrder ul").append(r)}else{$(".pcOrder").append('<tr>\n                <td colspan="5">\n                    <p>获取失败</p>\n                </td>\n            </tr>');r="<li>\n                    <div>\n                        <p>获取失败</p>\n                    </div>\n                </li>";$(".mOrder li").append(r)}}$(".pcOrder").html("Loading..."),$(".mOrder ul").html("Loading..."),api.getOrderList("",d),$(".myOrder").on("click","#cancel",function(){var e=$(this).attr("data-name");api.getOrderCancel(e);api.getOrderList("",d)}),$(".orderNav li").click(function(){var e=$(this).index();switch($(".list").hide().eq(e).show(),$(".orderNav li").removeClass("active"),$(this).addClass("active"),e){case 0:$(".pcOrder").html("Loading..."),$(".mOrder ul").html("Loading..."),api.getOrderList("",d);break;case 1:$(".collect ul").html(""),$.ajax({"type":"GET","url":"/"+urlL+"public/json/collect.json?page_size=10&page_num=1","dataType":"json","beforeSend":function(e){var r=(new Date).getTime(),n=$.md5(a+"shop"+r);e.setRequestHeader("token",a),e.setRequestHeader("time",r),e.setRequestHeader("secure_token",n)},"success":function(e){if("0"===e.success)if(0<e.data.length)e.data.forEach(function(e,r){var n='<li>\n                    <img src="'+e.pic+'" alt="">\n                    <div class="con">\n                        <p class="Title">'+e.name+'</p>\n                        <p class="description">'+e.detail+'</p>\n                        <p class="price"><span>常规价格：</span><del>￥'+e.origin_price+'</del></p>\n                        <p class="price"><span>学校优惠价：</span><em>￥'+e.edu_price+"</em></p>\n                    </div>\n                </li>";$(".collect ul").append(n)});else{var r="<li>\n                    <p>无数据</p>\n                </li>";$(".collect ul").append(r)}else r="<li>\n                    <p>无数据</p>\n                </li>",$(".collect ul").append(r)},"error":function(e,r,n){}})}}),$(".forMe").click(function(){null==t.questionnaire_option_id_group?location.href="questionnaire.html":location.href="recommendForMe.html"})});