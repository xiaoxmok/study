$(function(){login()&&(location.href="index.html"),$(".loging").click(function(){var e,o,r;$(".error").html("");var t=$("#select").children("option:selected").val();if(o=$(".password").val(),CheckPwd(o)){if("phone"===t){if(e=$(".account").val(),!CheckMobile(e))return void $(".error").html("账号格式不正确！");r={"verify_type":t,"phone":e,"password":o}}else if("email"===t){if(e=$(".account").val(),!CheckEmail(e))return void $(".error").html("邮箱格式不正确！");r={"verify_type":t,"email":e,"password":o}}$.ajax({"type":"POST","url":url+"/api/v1/user/login","dataType":"json","data":r,"success":function(e){if(200===e.code){var o=api.getUser(e.data.token);getCookie("token",e.data.token,{"expires":1,"path":"/"}),getCookie("username",o.name,{"expires":30,"path":"/"}),getCookie("userId",o.id,{"expires":30,"path":"/"});var r=api.getSchool(o.id,i18nLanguage);if(getCookie("school",r.name,{"expires":30,"path":"/"}),getCookie("schoolId",r.id,{"expires":30,"path":"/"}),null==o.name)return $(".error").html("首次登录，请完善资料"),void setTimeout(function(){location.href="prefectData.html"},2e3);$(".welcome").html("Dear "+o.name+",欢迎访问"+r.name+"专属页面。"),$(".error").html("登录成功，2秒后进入首页。"),setTimeout(function(){location.href="index.html"},2e3)}else $(".error").html(e.msg)},"error":function(e,o,r){}})}else $(".error").html("密码不合法，输入5-15位数！")})});