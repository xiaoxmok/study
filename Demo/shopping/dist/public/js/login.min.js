$(function(){login()&&(location.href="index.html"),$(".loging").click(function(){var e,o,r;$(".error").html("");var t=$("#select").children("option:selected").val();if(o=$(".password").val(),CheckPwd(o)){if("phone"===t){if(e=$(".account").val(),!CheckMobile(e))return void $(".error").html("账号格式不正确！");r={"verify_type":t,"phone":e,"password":o}}else if("email"===t){if(e=$(".account").val(),!CheckEmail(e))return void $(".error").html("邮箱格式不正确！");r={"verify_type":t,"email":e,"password":o}}$.ajax({"type":"POST","url":url+"/api/v1/user/login","dataType":"json","data":r,"success":function(e){if(console.log(e),200===e.code){var o=api.getUser(e.data.token);console.log(o,o.name,null!=o.name),getCookie("token",e.data.token,{"expires":30,"path":"/"}),null!=o.name&&($(".error").html("首次登录，请完善资料"),setTimeout(function(){location.href="prefectData.html"},2e3)),getCookie("username",o.name,{"expires":30,"path":"/"}),getCookie("school",o.school_no,{"expires":30,"path":"/"}),$(".welcome").html("Dear "+o.name+",欢迎访问"+o.school_no+"专属页面。"),$(".error").html("登录成功，2秒后进入首页。"),setTimeout(function(){},2e3)}else $(".error").html("登录失败")},"error":function(e,o,r){}})}else $(".error").html("密码不合法，输入5-15位数！")})});