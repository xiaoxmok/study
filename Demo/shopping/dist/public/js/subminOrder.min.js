$(function(){login()||(location.href="login.html");var a=getCookie("token");api.getAddressList(getCookie("userId")).forEach(function(e,a){var n;n="y"===e.is_default?'<p><input type="radio" name="addr" id="addr1" value="'+e.id+'" checked><label for="addr1"><span>'+e.reciever_name+"</span><span>"+e.address+"</span><span>"+e.reciever_phone+"</span>(默认)<span></span></label></p>":'<p><input type="radio" name="addr" id="addr2" value="'+e.id+'"><label for="addr2"><span>'+e.reciever_name+"</span><span>"+e.address+"</span><span>"+e.reciever_phone+"</span></label></p>",$(".shipping .con").append(n)});var e=GetRequest();console.log(e);var n=JSON.parse(e.order_items);$(".confirm table ul").html(""),n.forEach(function(e,a){var n=api.getSkuInfo(e.sku_id,i18nLanguage),t=(n.school_price*e.quantity).toFixed(2),i='<tr>\n                    <td>\n                        <div class="img"><img src="'+n.img_infos[0].url+'" alt=""></div>\n                        <div class="con">\n                            <p class="title">'+n.goods_name+'</p>\n                            <span class="price">￥<em>'+n.school_price+'</em></span>\n                            <span class="amountM">X'+e.quantity+'</span>\n                        </div>\n                    </td>\n                    <td class="td3">\n                        X'+e.quantity+'\n                    </td>\n                    <td class="totalPrice">￥<em>'+t+'</em></td>\n                    <td class="operate">\n                        <a href="javascript:;">删除</a>\n                    </td>\n                </tr>';$(".confirm table").append(i)}),$('.invoiceInfo input[name="info"]').click(function(){var e=$(this).val();"normal"===e?($(".invoiceType").hide(),$(".invoiceType").eq(0).show()):"vat"===e&&($(".invoiceType").hide(),$(".invoiceType").eq(1).show())});var t=0;$(".totalPrice").each(function(){t+=parseFloat($(this).find("em").html()),$(".Clearing .all em").html(t.toFixed(2))}),$(".Clearing .amount em").html(n.length),$(".submitOrder").click(function(){var e;e="normal"===$('.invoiceInfo input[name="info"]:checked').val()?{"token":a,"price":parseFloat($(".Clearing .all em").html()),"pay_type":"pay_type","order_type":"goods","address_id":$('.shipping input[name="addr"]:checked').val(),"message":$(".message textarea").val(),"order_items":[{"sku_id":"sku_id","quantity":"quantity"}],"billing_type":"normal","normal_invoice_type":$('.invoiceType input[name="type1"]:checked').val(),"normal_title":$("#normal_title").val(),"normal_tax_no":$("#normal_tax_no").val(),"normal_content":$('.invoiceType input[name="content1"]:checked').val()}:{"token":a,"price":parseFloat($(".Clearing .all em").html()),"pay_type":"pay_type","order_type":"goods","address_id":$('.shipping input[name="addr"]:checked').val(),"message":$(".message textarea").val(),"order_items":[{"sku_id":"sku_id","quantity":"quantity"}],"billing_type":"vat","vat_invoice_type":"company","vat_tax_no":$("#vat_tax_no").val(),"vat_content":"detail","vat_company":$("#vat_company").val(),"vat_address":$("#vat_address").val(),"vat_phone":$("#vat_phone").val(),"vat_bank":$("#vat_bank").val(),"vat_bank_no":$("#vat_bank_no").val(),"receiver_name":$("#receiver_name").val(),"receiver_phone":$("#receiver_phone").val(),"receiver_province":$("#receiver_phone").val(),"receiver_city":$("#receiver_phone").val(),"receiver_area":$("#receiver_phone").val(),"receiver_address":$("#receiver_address").val()},$.ajax({"type":"POST","url":url+"/api/v1/order/create","dataType":"json","data":e,"success":function(e){200===e.code&&setTimeout(function(){location.href="bank.html"},2e3),location.href="payment.html"},"error":function(){}})})});