$(function(){login()||(location.href="login.html");var a=[];$(".file").change(function(){var e=new FormData;e.append("file",$(this).get(0).files[0]),e.append("token",c);var r=$(this);$.ajax({"type":"POST","url":url+"/api/v1/system/image-upload","dataType":"json","contentType":!1,"processData":!1,"data":e,"success":function(e){200===e.code&&(r.parent().find(".imgshow").attr("src",e.data[0].url),r.parent().find(".imgshow").attr("data-name",e.data[0].id),a.push(e.data[0].id))},"error":function(){}})});var l,c=getCookie("token"),s=GetRequest();api.getOrderInfo(s.id,function(e){$("#price").val(e.price),l=e.price}),$("#price").keyup(function(){$(this).val($(this).val().replace(/[^\d.]/g,"")),$(this).val()>l?isEnglish()?$(".error").html("The return amount cannot exceed the order amount."):$(".error").html("退货金额不能超过订单金额。"):$(".error").html("")}),$(".submit").click(function(){var r=$("#type").children("option:selected").val(),e=$("#reason").children("option:selected").val(),t=$("#price").val(),n=$("#description").val(),o=$("#phone").val();if(CheckMobile(o))if(l<t)isEnglish()?$(".error").html("The return amount cannot exceed the order amount."):$(".error").html("退货金额不能超过订单金额。");else{var i={"token":c,"order_no":s.id,"type":r,"reason":e,"price":t,"phone":o,"reason_detail":n};0!==a.length&&(i.img_ids=a.join(",")),$.ajax({"type":"POST","url":url+"/api/v1/order/return-or-exchange","dataType":"json","data":i,"success":function(e){200===e.code&&(isEnglish()?$(".error").html("Submitted successfully"):$(".error").html("提交成功"),setTimeout(function(){location.href="returnsNumber.html?id="+s.id+"&type="+r},1e3))},"error":function(e,r,t){}})}else isEnglish()?$(".error").html("Contact phone format is incorrect"):$(".error").html("联系电话格式不正确")})});