$(function(){login()&&(location.href="index.html"),$(".loging").click(function(){var n,e,o;$(".error").html("");var i=$("#select").children("option:selected").val();if(e=$(".password").val(),CheckPwd(e)){if("phone"===i){if(n=$(".account").val(),!CheckMobile(n))return void(isEnglish()?$(".error").html("Account format is incorrect."):$(".error").html("账号格式不正确."));o={"verify_type":i,"phone":n,"password":e}}else if("email"===i){if(n=$(".account").val(),!CheckEmail(n))return void(isEnglish()?$(".error").html("E-mail format is incorrect."):$(".error").html("邮箱格式不正确。"));o={"verify_type":i,"email":n,"password":e}}$.ajax({"type":"POST","url":url+"/api/v1/user/login","dataType":"json","data":o,"success":function(e){if(200===e.code){var o=api.getUser(e.data.token);getCookie("token",e.data.token,{"expires":1,"path":"/"}),getCookie("account",n,{"expires":1,"path":"/"}),null==o.name&&(o.name=""),getCookie("username",o.name,{"expires":30,"path":"/"}),getCookie("userId",o.id,{"expires":30,"path":"/"});var i=api.getSchool(o.school_info.id,i18nLanguage);if(null==i.name&&(i.name=""),getCookie("school",i.name,{"expires":30,"path":"/"}),getCookie("schoolId",i.id,{"expires":30,"path":"/"}),null===o.name){var t={"token":e.data.token,"user_id":o.id,"reciever_name":n,"reciever_phone":o.phone?o.phone:" ","address":o.school_info.name+" "+o.school_region_info.name,"is_default":"y","is_from_school":"y"};$.ajax({"type":"POST","url":url+"/api/v1/address/create","dataType":"json","data":t,"success":function(e){},"error":function(e,o,i){}})}var r=getCookie("username");if(getCookie("username").length<=0){var a,l=getCookie("account");a=CheckMobile(l)?l.slice(0,3)+"****"+l.slice(-4):l.split("@")[0].slice(0,-4)+"****@"+l.split("@")[1],isEnglish()?$(".welcome").html("Dear "+a+", Welcome to "+getCookie("school")+" page."):$(".welcome").html("Dear "+a+", 欢迎访问"+getCookie("school")+"专属页面。")}else isEnglish()?$(".welcome").html("Dear "+r+", Welcome to "+getCookie("school")+" page."):$(".welcome").html("Dear "+r+", 欢迎访问"+getCookie("school")+"专属页面。");if(getCookie("localCart")){$(".error").html("临时购物车存在商品，将批量加入本账户。");var s=[];if(getCookie("localCart"))(l=getCookie("localCart")).split(",").forEach(function(e,o){e={"sku_id":e.split("-")[0],"quantity":e.split("-")[1]};s.push(e)});$.ajax({"type":"POST","url":url+"/api/v1/cart/batch-create","dataType":"json","data":{"token":e.data.token,"user_id":o.id,"items":JSON.stringify(s)},"success":function(e){e.code},"error":function(){}})}setTimeout(function(){window.history.go(-1)},2e3)}else $(".error").html(e.msg)},"error":function(e,o,i){}})}else isEnglish()?$(".error").html("The password is illegal"):$(".error").html("密码不合法，输入5-15位数！")})});