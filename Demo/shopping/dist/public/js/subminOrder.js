$(function(){login()||(location.href="login.html");var a=getCookie("token");api.getAddressList(getCookie("userId")).forEach(function(e,a){var n;n="y"===e.is_default?'<p><input type="radio" name="addr" id="addr1" value="'+e.id+'" checked><label for="addr1"><span>'+e.reciever_name+"</span><span>"+e.address+"</span><span>"+e.reciever_phone+"</span>(默认)<span></span></label></p>":'<p><input type="radio" name="addr" id="addr2" value="'+e.id+'"><label for="addr2"><span>'+e.reciever_name+"</span><span>"+e.address+"</span><span>"+e.reciever_phone+"</span></label></p>",$(".shipping .con").append(n)});var e=GetRequest(),n=[];for(var i in e){var t=e[i].split("_"),o={"sku_id":t[0],"quantity":t[1]};n.push(o)}$(".confirm table ul").html(""),n.forEach(function(e,a){var n=api.getSkuInfo(e.sku_id,i18nLanguage),i=(n.school_price*e.quantity).toFixed(2),t='<tr>\n                    <td>\n                        <div class="img"><img src="'+n.img_infos[0].url+'" alt=""></div>\n                        <div class="con">\n                            <p class="title">'+n.goods_name+'</p>\n                            <span class="price">￥<em>'+n.school_price+'</em></span>\n                            <span class="amountM">X'+e.quantity+'</span>\n                        </div>\n                    </td>\n                    <td class="td3">\n                        X'+e.quantity+'\n                    </td>\n                    <td class="totalPrice">￥<em>'+i+"</em></td>\n                </tr>";$(".confirm table").append(t)}),$('.invoiceInfo input[name="info"]').click(function(){var e=$(this).val();"normal"===e?($(".invoiceType").hide(),$(".invoiceType").eq(0).show()):"vat"===e&&($(".invoiceType").hide(),$(".invoiceType").eq(1).show())}),$('.invoiceType input[name="type1"]').click(function(){var e=$(this).val();console.log(e),"personal"===e?$(".tax_no").hide():"company"===e&&$(".tax_no").show()});var r=0;$(".totalPrice").each(function(){r+=parseFloat($(this).find("em").html()),$(".Clearing .all em").html(r.toFixed(2))}),$(".Clearing .amount em").html(n.length),$(".payInfo input").click(function(){"unionpay"===$(this).val()?$(".union_span").show():$(".union_span").hide()}),$(".submitOrder").click(function(){var e;e="normal"===$('.invoiceInfo input[name="info"]:checked').val()?{"token":a,"price":parseFloat($(".Clearing .all em").html()),"pay_type":$('.payInfo input[name="payInfo"]:checked').val(),"order_type":"goods","address_id":$('.shipping input[name="addr"]:checked').val(),"message":$(".message textarea").val(),"order_items":JSON.stringify(n),"billing_type":"normal","normal_invoice_type":$('.invoiceType input[name="type1"]:checked').val(),"normal_title":$("#normal_title").val(),"normal_content":$('.invoiceType input[name="content1"]:checked').val()}:{"token":a,"price":parseFloat($(".Clearing .all em").html()),"pay_type":$('.payInfo input[name="payInfo"]:checked').val(),"order_type":"goods","address_id":$('.shipping input[name="addr"]:checked').val(),"message":$(".message textarea").val(),"order_items":JSON.stringify(n),"billing_type":"vat","vat_invoice_type":"company","vat_tax_no":$("#vat_tax_no").val(),"vat_content":"detail","vat_company":$("#vat_company").val(),"vat_address":$("#vat_address").val(),"vat_phone":$("#vat_phone").val(),"vat_bank":$("#vat_bank").val(),"vat_bank_no":$("#vat_bank_no").val(),"receiver_name":$("#receiver_name").val(),"receiver_phone":$("#receiver_phone").val(),"receiver_province":$("#receiver_province option:selected").val(),"receiver_city":$("#receiver_city option:selected").val(),"receiver_area":$("#receiver_area option:selected").val(),"receiver_address":$("#receiver_address").val()},console.log(e),null==e.address_id?$(".error").html("请选择地址。"):($(".error").html(""),$.ajax({"type":"POST","url":url+"/api/v1/order/create","dataType":"json","data":e,"success":function(e){200===e.code&&(location.href="payment.html?orderNo="+e.data.orderNo)},"error":function(){}}))})});