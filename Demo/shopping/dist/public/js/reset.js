$(function(){login()||(location.href="index.html");var n=getCookie("token");$(".code").click(function(){var e,o;$(".error").html("");var r=$("#select").children("option:selected").val();if("phone"===r){if(e=$(".account").val(),!CheckMobile(e))return void $(".error").html("账号格式不正确！");o={"verify_type":r,"phone":e}}else if("email"===r){if(e=$(".account").val(),!CheckEmail(e))return void $(".error").html("邮箱格式不正确！");o={"verify_type":r,"email":e}}var t,i=60;function l(){i--,$(".timeOut").html(i),i<0&&(clearInterval(t),$(".code").show(),$(".countDown").hide(),i=10)}$.ajax({"type":"POST","url":url+"/api/v1/user/send-verify-code","dataType":"json","data":o,"success":function(e){200===e.code?(console.log("获取验证码成功！"),$(".timeOut").html(i),t=setInterval(l,1e3),$(".code").hide(),$(".countDown").show()):$(".error").html(e.msg)},"error":function(e,o,r){console.log(e,o,r)}})}),$(".reset").click(function(){var e,o,r,t,i;$(".error").html("");var l=$("#select").children("option:selected").val();if(r=$(".valid_code").val(),CheckCode(r))if(o=$(".password").val(),CheckPwd(o))if((t=$(".confirmation").val())===o){if("phone"===l){if(e=$(".account").val(),!CheckMobile(e))return void $(".error").html("账号格式不正确！");i={"token":n,"verify_type":l,"phone":e,"verify_code":r,"password":o,"password_confirmation":t}}else if("email"===l){if(e=$(".account").val(),!CheckEmail(e))return void $(".error").html("邮箱格式不正确！");i={"token":n,"verify_type":l,"email":e,"verify_code":r,"password":o,"password_confirmation":t}}$.ajax({"type":"POST","url":url+"/api/v1/user/reset-password","dataType":"json","data":i,"success":function(e){200===e.code?($(".error").html("重置密码成功，请重新登录。"),setTimeout(function(){delAllCookie(),location.href="login.html"},2e3)):$(".error").html(e.msg)},"error":function(e,o,r){}})}else $(".error").html("确认密码错误。");else $(".error").html("密码不合法，输入5-15位数！");else $(".error").html("验证码格式不正确。")})});