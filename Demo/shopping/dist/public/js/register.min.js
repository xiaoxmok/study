$(function(){login()&&(location.href="index.html");getCookie("token");$.ajax({"type":"GET","url":url+"/api/v1/school/index?city=&lang="+i18nLanguage,"dataType":"json","success":function(e){if(200===e.code)for(var o=0;o<e.data.length;o++){var t='<option value="'+e.data[o].id+'">'+e.data[o].name+"</option>";$("#schoolSearch").append(t)}else{t='<option value="error">'+e.msg+"</option>";$("#schoolSearch").append(t),$(".error").html(e.msg)}},"error":function(e,o,t){console.log(e,o,t)}});api.getCaptcha();$("#Captcha").attr("src","http://byod.1o24.com/api/v1/system/get-captcha"),$("#Captcha").click(function(){$("#Captcha").attr("src","http://byod.1o24.com/api/v1/system/get-captcha?t="+Math.random())}),$(".code").click(function(){var e,o;$(".error").html("");var t=$("#select").children("option:selected").val();if("phone"===t){if(e=$(".account").val(),!CheckMobile(e))return void $(".error").html("账号格式不正确！");o={"verify_type":t,"phone":e}}else if("email"===t){if(e=$(".account").val(),!CheckEmail(e))return void $(".error").html("邮箱格式不正确！");o={"verify_type":t,"email":e}}var r=$(".Captcha_code").val();if(0!==r.length){o.captcha=r;var a,c=60;$.ajax({"type":"POST","url":url+"/api/v1/user/send-verify-code","dataType":"json","data":o,"success":function(e){200===e.code?(console.log("获取验证码成功！"),$(".timeOut").html(c),a=setInterval(i,1e3),$(".code").hide(),$(".countDown").show()):$(".error").html(e.msg)},"error":function(e,o,t){console.log(e,o,t)}})}else $(".error").html("图形验证码不能为空");function i(){c--,$(".timeOut").html(c),c<0&&(clearInterval(a),$(".code").show(),$(".countDown").hide(),c=10)}}),$(".register").click(function(){var e,o,t,r,a;$(".error").html("");var c=$("#select").children("option:selected").val();if(t=$(".valid_code").val(),CheckCode(t))if(o=$(".password").val(),CheckPwd(o)){if(r=$("#schoolSearch").children("option:selected").val(),"phone"===c){if(e=$(".account").val(),!CheckMobile(e))return void $(".error").html("账号格式不正确！");a={"verify_type":c,"phone":e,"verify_code":t,"password":o,"school_id":r}}else if("email"===c){if(e=$(".account").val(),!CheckEmail(e))return void $(".error").html("邮箱格式不正确！");a={"verify_type":c,"email":e,"verify_code":t,"password":o,"school_region_id":r}}$.ajax({"type":"POST","url":url+"/api/v1/user/register","dataType":"json","data":a,"success":function(e){200===e.code?($(".error").html("注册成功，自动跳转登录页面。"),setTimeout(function(){location.href="login.html"},2e3)):$(".error").html(e.detail)},"error":function(e,o,t){}})}else $(".error").html("密码不合法，输入5-15位数！");else $(".error").html("验证码格式不正确。")})});