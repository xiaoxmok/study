$(function(){login()&&(location.href="index.html");var t=getCookie("token");$.ajax({"type":"GET","url":"/"+url+"public/json/school-search.json","dataType":"json","beforeSend":function(e){var o=(new Date).getTime(),r=$.md5(t+"shop"+o);e.setRequestHeader("token",t),e.setRequestHeader("time",o),e.setRequestHeader("secure_token",r)},"success":function(e){if("0"===e.success)for(var o=0;o<e.data.length;o++){var r='<option value="'+e.data[o].id+'">'+e.data[o].name+"</option>";$("#schoolSearch").append(r)}else{r='<option value="error">'+e.detail+"</option>";$("#schoolSearch").append(r),$(".error").html(e.detail)}},"error":function(e,o,r){console.log(e,o,r)}}),$(".code").click(function(){var e;$(".error").html("");var o=$("#select").children("option:selected").val();if("phone"===o){if(e=$(".account").val(),!CheckMobile(e))return void $(".error").html("手机号码不正确！")}else if("email"===o)return void $(".error").html("请选择手机");var r,t=60;function l(){t--,$(".timeOut").html(t),t<0&&(clearInterval(r),$(".code").show(),$(".countDown").hide(),t=10)}$.ajax({"type":"GET","url":"/"+url+"public/json/phone_valid_code.json?phone="+e,"dataType":"json","success":function(e){"0"===e.success?(console.log("获取验证码成功！"),$(".timeOut").html(t),r=setInterval(l,1e3),$(".code").hide(),$(".countDown").show()):$(".error").html(e.detail)},"error":function(e,o,r){console.log(e,o,r)}})}),$(".register").click(function(){var e,o,r,t;$(".error").html("");var l=$("#select").children("option:selected").val();if("phone"===l){if(e=$(".account").val(),!CheckMobile(e))return void $(".error").html("账号格式不正确！")}else if("email"===l&&(e=$(".account").val(),!CheckEmail(e)))return void $(".error").html("邮箱格式不正确！");r=$(".valid_code").val(),CheckCode(r)?(o=$(".password").val(),CheckPwd(o)?(t=$("#schoolSearch").children("option:selected").val(),$.ajax({"type":"GET","url":"/"+url+"public/json/register.json?"+l+"="+e+"&password="+o+"&school_id="+t+"&valid_code="+r,"dataType":"json","success":function(e){"0"===e.success?($(".error").html("注册成功，自动跳转登录页面。"),setTimeout(function(){location.href="login.html"},2e3)):$(".error").html(e.detail)},"error":function(e,o,r){}})):$(".error").html("密码不合法，输入5-15位数！")):$(".error").html("验证码格式不正确。")})});