$(function(){login()||(location.href="login.html");var e,n,a,r,t,i,s=getCookie("token"),d=api.getUser(s);"zh"===getCookie("userLanguage")?("male"===d.sex?e="男":"female"===d.sex&&(e="女"),"student"===d.type?n="学生":"teacher"===d.type?n="老师":"staff"===d.type&&(n="教职员工")):"en"===getCookie("userLanguage")&&("male"===d.sex?e="male":"female"===d.sex&&(e="female"),"student"===d.type?n="student":"teacher"===d.type?n="teacher":"staff"===d.type&&(n="staff")),$(".userName .person .name").html(d.name),$(".userName .person .sex").html(e),$(".userName .person .role").html(n),r="student"===d.type?isEnglish()?"Student ID No.: ":"学号: ":isEnglish()?"Staff: ":"教职员工号: ",a=null!==d.school_no?d.school_no:isEnglish()?"unfilled":"未填写",$(".userName .person .no em").html(r+a),t=null!==d.email?d.email.split("@")[0].slice(0,-4)+"****@"+d.email.split("@")[1]:isEnglish()?"unfilled":"未填写",$(".userName .person .email em").html(t),$(".userName .person .phone em").html(d.phone.slice(0,3)+"****"+d.phone.slice(-4)),api.getAddressList(getCookie("userId")).forEach(function(e,n){"y"===e.is_default&&(i=e.address)}),$(".userName .person .address em").html(i);var o,l,c,p=api.getSchool(d.school_info.id,i18nLanguage);function u(e){var n;if($(".pcOrder").html(""),$(".mOrder ul").html(""),n=isEnglish()?"<tr>\n                <th>Order No.</th>\n                <th>Order Status</th>\n                <th>Order Amount</th>\n                <th>Manage</th>\n            </tr>":"<tr>\n                <th>订单号</th>\n                <th>订单状态</th>\n                <th>订单金额</th>\n                <th>操作</th>\n            </tr>",$(".pcOrder").append(n),200===e.code)if(0<e.data.length){e.data.forEach(function(e,n){var a,r;if(isEnglish()?"waitingForPay"===e.status?a='              <a href="./ordersDetail.html?id='+e.order_no+'">Details</a>\n                    <a href="./payment.html?orderNo='+e.order_no+'&center=true">Go to pay</a>\n                    <a href="javascript:;" id="cancel" data-name="'+e.order_no+'">Cancel Order</a>\n':"paying"===e.status?a='              <a href="./ordersDetail.html?id='+e.order_no+'">Details</a>\n':"paid"===e.status?a='              <a href="./ordersDetail.html?id='+e.order_no+'">Details</a>\n                    <a href="./invoice.html?order_no='+e.order_no+'">Request an invoice (Fapiao)</a>\n                    <a href="./returns.html?id='+e.order_no+'">Return and Refund</a>':"waitingForInstall"===e.status?a='              <a href="./ordersDetail.html?id='+e.order_no+'">Details</a>\n                    <a href="./invoice.html?order_no='+e.order_no+'">Request an invoice (Fapiao)</a>\n                    <a href="./returns.html?id='+e.order_no+'">Return and Refund</a>\n':"installing"===e.status?a='              <a href="./ordersDetail.html?id='+e.order_no+'">Details</a>\n                    <a href="./invoice.html?order_no='+e.order_no+'">Request an invoice (Fapiao)</a>\n                    <a href="./returns.html?id='+e.order_no+'">Return and Refund</a>\n':"installed"===e.status?a='              <a href="./ordersDetail.html?id='+e.order_no+'">Details</a>\n                    <a href="./invoice.html?order_no='+e.order_no+'">Request an invoice (Fapiao)</a>\n                    <a href="./returns.html?id='+e.order_no+'">Return and Refund</a>\n':"dispatching"===e.status?a='              <a href="./ordersDetail.html?id='+e.order_no+'">Details</a>\n                    <a href="./invoice.html?order_no='+e.order_no+'">Request an invoice (Fapiao)</a>\n                    <a href="./returns.html?id='+e.order_no+'">Return and Refund</a>\n':"waitingForSign"===e.status?a='              <a href="./ordersDetail.html?id='+e.order_no+'">Details</a>\n                    <a href="./invoice.html?order_no='+e.order_no+'">Request an invoice (Fapiao)</a>\n                    <a href="./returns.html?id='+e.no+'">Return and Refund</a>\n':"signed"===e.status?a='              <a href="./ordersDetail.html?id='+e.order_no+'">Details</a>\n                    <a href="./invoice.html?order_no='+e.order_no+'">Request an invoice (Fapiao)</a>\n                    <a href="./returns.html?id='+e.order_no+'">Return and Refund</a>\n':"canceled"===e.status?a='              <a href="./ordersDetail.html?id='+e.order_no+'">Details</a>\n':"waitingForReturn"===e.status?a='              <a href="./ordersDetail.html?id='+e.order_no+'">Details</a>\n':"returned"===e.status?a='              <a href="./ordersDetail.html?id='+e.order_no+'">Details</a>\n':"exchanged"===e.status&&(a='              <a href="./ordersDetail.html?id='+e.order_no+'">Details</a>\n                    <a href="./invoice.html?order_no='+e.order_no+'">Request an invoice (Fapiao)</a>\n                    <a href="./returns.html?id='+e.order_no+'">Return and Refund</a>\n'):"waitingForPay"===e.status?a='              <a href="./ordersDetail.html?id='+e.order_no+'">查看详情</a>\n                    <a href="./payment.html?orderNo='+e.order_no+'&center=true">去支付</a>\n                    <a href="javascript:;" id="cancel" data-name="'+e.order_no+'">取消订单</a>\n':"paying"===e.status?a='              <a href="./ordersDetail.html?id='+e.order_no+'">查看详情</a>\n':"paid"===e.status?a='              <a href="./ordersDetail.html?id='+e.order_no+'">查看详情</a>\n                    <a href="./invoice.html?order_no='+e.order_no+'">开具发票</a>\n                    <a href="./returns.html?id='+e.order_no+'">退换货</a>':"waitingForInstall"===e.status?a='              <a href="./ordersDetail.html?id='+e.order_no+'">查看详情</a>\n                    <a href="./invoice.html?order_no='+e.order_no+'">开具发票</a>\n                    <a href="./returns.html?id='+e.order_no+'">退换货</a>\n':"installing"===e.status?a='              <a href="./ordersDetail.html?id='+e.order_no+'">查看详情</a>\n                    <a href="./invoice.html?order_no='+e.order_no+'">开具发票</a>\n                    <a href="./returns.html?id='+e.order_no+'">退换货</a>\n':"installed"===e.status?a='              <a href="./ordersDetail.html?id='+e.order_no+'">查看详情</a>\n                    <a href="./invoice.html?order_no='+e.order_no+'">开具发票</a>\n                    <a href="./returns.html?id='+e.order_no+'">退换货</a>\n':"dispatching"===e.status?a='              <a href="./ordersDetail.html?id='+e.order_no+'">查看详情</a>\n                    <a href="./invoice.html?order_no='+e.order_no+'">开具发票</a>\n                    <a href="./returns.html?id='+e.order_no+'">退换货</a>\n':"waitingForSign"===e.status?a='              <a href="./ordersDetail.html?id='+e.order_no+'">查看详情</a>\n                    <a href="./invoice.html?order_no='+e.order_no+'">开具发票</a>\n                    <a href="./returns.html?id='+e.no+'">退换货</a>\n':"signed"===e.status?a='              <a href="./ordersDetail.html?id='+e.order_no+'">查看详情</a>\n                    <a href="./invoice.html?order_no='+e.order_no+'">开具发票</a>\n                    <a href="./returns.html?id='+e.order_no+'">退换货</a>\n':"canceled"===e.status?a='              <a href="./ordersDetail.html?id='+e.order_no+'">查看详情</a>\n':"waitingForReturn"===e.status?a='              <a href="./ordersDetail.html?id='+e.order_no+'">查看详情</a>\n':"returned"===e.status?a='              <a href="./ordersDetail.html?id='+e.order_no+'">查看详情</a>\n':"exchanged"===e.status&&(a='              <a href="./ordersDetail.html?id='+e.order_no+'">查看详情</a>\n                    <a href="./invoice.html?order_no='+e.order_no+'">开具发票</a>\n                    <a href="./returns.html?id='+e.order_no+'">退换货</a>\n'),r=isEnglish()?'<tr>\n                <td>\n                    <div class="img"><img src="'+e.goods_cover_url+'" alt=""><p>'+e.goods_sum+' Pieces</p></div>\n                    <div class="con">\n                        <p>Order No.: '+e.order_no+"</p>\n                        <span>Order Created at: "+e.created_at+"</span>\n                    </div>\n                </td>\n                <td>"+o[e.status]+"</td>\n                <td>￥"+toPrice(e.price)+'</td>\n                <td class="operate">\n'+a+"                </td>\n            </tr>":'<tr>\n                <td>\n                    <div class="img"><img src="'+e.goods_cover_url+'" alt=""><p>共'+e.goods_sum+'件</p></div>\n                    <div class="con">\n                        <p>订单号：'+e.order_no+"</p>\n                        <span>下单时间："+e.created_at+"</span>\n                    </div>\n                </td>\n                <td>"+o[e.status]+"</td>\n                <td>￥"+toPrice(e.price)+'</td>\n                <td class="operate">\n'+a+"                </td>\n            </tr>",$(".pcOrder").append(r),isEnglish())var t='<li>\n                    <div class="up">\n                        <div class="img"><img src="'+e.goods_cover_url+'" alt=""><p>共'+e.goods_sum+'件</p></div>\n                        <div class="con">\n                            <p>Order No.：'+e.order_no+"</p>\n                            <span>Order Created at:"+e.created_at+'</span>\n                        </div>\n                        <div class="status">Order Status：'+o[e.status]+'</div>\n                    </div>\n                    <div class="down">\n'+a+"                    </div>\n                </li>";else t='<li>\n                    <div class="up">\n                        <div class="img"><img src="'+e.goods_cover_url+'" alt=""><p>共'+e.goods_sum+'件</p></div>\n                        <div class="con">\n                            <p>订单号：'+e.order_no+"</p>\n                            <span>下单时间："+e.created_at+'</span>\n                        </div>\n                        <div class="status">订单状态：'+o[e.status]+'</div>\n                    </div>\n                    <div class="down">\n'+a+"                    </div>\n                </li>";$(".mOrder ul").append(t)})}else{$(".pcOrder").append('<tr>\n                <td colspan="5">\n                    <p>none</p>\n                </td>\n            </tr>');var a="<li>\n                    <div>\n                        <p>none</p>\n                    </div>\n                </li>";$(".mOrder ul").append(a)}else{$(".pcOrder").append('<tr>\n                <td colspan="5">\n                    <p>error</p>\n                </td>\n            </tr>');a="<li>\n                    <div>\n                        <p>error</p>\n                    </div>\n                </li>";$(".mOrder li").append(a)}}function h(e){switch($(".list").hide().eq(e).show(),$(".orderNav li").removeClass("active"),$(".orderNav li").eq(e).addClass("active"),e){case 0:$(".pcOrder").html("Loading..."),$(".mOrder ul").html("Loading..."),api.getOrderList("",u);break;case 1:$(".collect ul").html(""),$.ajax({"type":"GET","url":url+"/api/v1/fav/index?token="+s+"&lang="+i18nLanguage,"dataType":"json","success":function(e){if(200===e.code)if(0<e.data.length)e.data.forEach(function(e,n){if(null!==e.summary?summary=e.summary:summary="Not described",isEnglish())var a='<li>\n                    <a href="./product.html?id='+e.id+'">\n                    <img src="'+e.img_infos[0].url+'" alt="">\n                    <div class="con">\n                        <p class="Title">'+e.name+'</p>\n                        <p class="description">'+summary+'</p>\n                        <p class="price"><span>MSRP：</span><del>￥'+toPrice(e.price)+'</del></p>\n                        <p class="price"><span>School Special Offer：</span><em>￥'+toPrice(e.school_price)+"</em></p>\n                    </div>\n                    </a>\n                </li>";else a='<li>\n                    <a href="./product.html?id='+e.id+'">\n                    <img src="'+e.img_infos[0].url+'" alt="">\n                    <div class="con">\n                        <p class="Title">'+e.name+'</p>\n                        <p class="description">'+summary+'</p>\n                        <p class="price"><span>常规价格：</span><del>￥'+toPrice(e.price)+'</del></p>\n                        <p class="price"><span>学校优惠价：</span><em>￥'+toPrice(e.school_price)+"</em></p>\n                    </div>\n                    </a>\n                </li>";$(".collect ul").append(a)});else{var n="<li>\n                    <p>no data</p>\n                </li>";$(".collect ul").append(n)}else n="<li>\n                    <p>no data</p>\n                </li>",$(".collect ul").append(n)},"error":function(e,n,a){}});break;case 2:$.ajax({"type":"post","url":url+"/api/v1/user/device-list","dataType":"json","data":{"token":s,"lang":i18nLanguage},"success":function(e){e.code},"error":function(){}});break;case 3:$.ajax({"type":"GET","url":url+"/api/v1/coupon/index?token="+s+"&type=repair ","dataType":"json","success":function(e){if(200===e.code){var n=e.data;$(".ticket ul").html(""),n.forEach(function(e,n){var a;a=isEnglish()?'<li class="ticket1">\n                <div class="up">\n                    <div class="img"></div>\n                    <p>'+e.type+'</p>\n                </div>\n                <div class="down">\n                    <a href="javascript:;">Unused</a>\n                </div>\n            </li>':'<li class="ticket1">\n                <div class="up">\n                    <div class="img"></div>\n                    <p>'+{"repair":"维修券"}[e.type]+'</p>\n                </div>\n                <div class="down">\n                    <a href="javascript:;">未使用</a>\n                </div>\n            </li>',$(".ticket ul").append(a)})}},"error":function(e,n,a){}});break;case 4:$(".pcService").html("Loading..."),$(".mService ul").html("Loading..."),$.ajax({"type":"GET","url":url+"/api/v1/repair/index?token="+s,"dataType":"json","success":function(e){if(200===e.code){var n,a=e.data;$(".pcService").html(""),$(".mService ul").html(""),n=isEnglish()?"<tr>\n                <th>Fault description</th>\n                <th>Fault image</th>\n                <th>No.</th>\n                <th>Evaluation</th>\n                <th>Operating</th>\n                <th>Status</th>\n                <th>Backup Status</th>\n            </tr>":"<tr>\n                <th>故障描述</th>\n                <th>故障照片</th>\n                <th>设备型号</th>\n                <th>维修评估</th>\n                <th>操作</th>\n                <th>维修状态</th>\n                <th>备用状态</th>\n            </tr>",$(".pcService").append(n),a.forEach(function(e,n){var a,r,t;t=0<e.img_infos.length?e.img_infos[0].url:"",isEnglish()?(a="<tr>\n                <td><p>"+e.description+'</p></td>\n                <td><div class="img"><img src="'+t+'" alt=""></div></td>\n                <td><p>'+e.order_no+"</p></td>\n                <td><p>"+e.evaluation+'</p></td>\n                <td class="operate"><a href="javascript:;">'+c[e.backup_status]+'</a></td>\n                <td class="status">\n                    <p>'+l[e.status]+"</p>\n                    <span>repair no："+e.repair_no+'</span>\n                </td>\n                <td class="backup_status">\n                    <p>'+c[e.backup_status]+"</p>\n                    <span>Created time："+e.created_at+"</span>\n                </td>\n            </tr>",r='<li>\n                    <div class="up">\n                        <div class="operate">\n                            <div>repair no：<em>'+e.repair_no+'</em></div>\n                            <div class="status">'+l[e.status]+'</div>\n                        </div>\n                        <div class="operate">\n                            <div>order no：<em>'+e.order_no+'</em></div>\n                            <div class="status">'+c[e.backup_status]+'</div>\n                        </div>                        <div class="text">\n                            <div class="question">\n                                <span>'+e.description+'</span>\n                            </div>\n                            <div class="assess">\n                                <span>'+e.evaluation+'</span>\n                            </div>\n                        </div>\n                        <div class="operate">\n                            <div class="status">'+l[e.status]+'</div>\n                            <div class="time"><span>Created time：'+e.created_at+'</span></div>\n                        </div>\n                    </div>\n                    <div class="down">\n                        <a href="javascript:;">'+c[e.backup_status]+"</a>\n                    </div>\n                </li>"):(a="<tr>\n                <td><p>"+e.description+'</p></td>\n                <td><div class="img"><img src="'+t+'" alt=""></div></td>\n                <td><p>'+e.order_no+"</p></td>\n                <td><p>"+e.evaluation+'</p></td>\n                <td class="operate"><a href="javascript:;">'+c[e.backup_status]+'</a></td>\n                <td class="status">\n                    <p>'+l[e.status]+"</p>\n                    <span>单号："+e.repair_no+'</span>\n                </td>\n                <td class="backup_status">\n                    <p>'+c[e.backup_status]+"</p>\n                    <span>创建时间："+e.created_at+"</span>\n                </td>\n            </tr>",r='<li>\n                    <div class="up">\n                        <div class="operate">\n                            <div>单号：<em>'+e.repair_no+'</em></div>\n                            <div class="status">'+l[e.status]+'</div>\n                        </div>\n                        <div class="operate">\n                            <div>设备型号：<em>'+e.order_no+'</em></div>\n                            <div class="status">'+c[e.backup_status]+'</div>\n                        </div>                        <div class="text">\n                            <div class="question">\n                                <span>'+e.description+'</span>\n                            </div>\n                            <div class="assess">\n                                <span>'+e.evaluation+'</span>\n                            </div>\n                        </div>\n                        <div class="operate">\n                            <div class="status">'+l[e.status]+'</div>\n                            <div class="time"><span>提交时间：'+e.created_at+'</span></div>\n                        </div>\n                    </div>\n                    <div class="down">\n                        <a href="javascript:;">'+c[e.backup_status]+"</a>\n                    </div>\n                </li>"),$(".pcService").append(a),$(".mService ul").append(r)})}},"error":function(e,n,a){}})}}$(".school .img img").attr("src",p.logo_info.url),$(".school .con .title").html(p.name),$(".school .con span").html(p.description),o=isEnglish()?{"waitingForPay":"Waiting for payment","paying":"Paying","paid":"Paid","waitingForInstall":"Waiting for Install","installing":"Installation in Progress","installed":"Installed","dispatching":"Delivering","dispatched":"Shipped to Destination","waitingForSign":"Waiting For Sign","signed":"Delivered","canceled":"Canceled","returning":"Returning","waitingForExchange":"Waiting for Exchanging","returned":"Returned","exchanging":"Exchanging","exchanged":"Exchanged","waitingForReturn":"returnHandled"}:{"waitingForPay":"待支付","paying":"支付中","paid":"已支付","waitingForInstall":"待安装","installing":"安装中","installed":"已安装","dispatching":"配送中","dispatched":"已配送","waitingForSign":"待签收","signed":"已签收","canceled":"已取消","returning":"退货中","refuseForReturn":"退货处理完成","waitingForExchange":"待换货","returned":"已退货","exchanging":"换货中","exchanged":"已换货","waitingForReturn":"待退货","refuseForExchange":"拒绝换货"},$(".pcOrder").html("Loading..."),$(".mOrder ul").html("Loading..."),api.getOrderList("",u),$(".myOrder").on("click","#cancel",function(){var e=$(this).attr("data-name");api.getOrderCancel(e);api.getOrderList("",u)}),isEnglish()?(l={"uSubmited":"uSubmited","pReceived":"pReceived","pEvaluated":"pEvaluated","uConfirmed":"uConfirmed","pRepairing":"pRepairing","pRepaired":"pRepaired","uReceived":"uReceived","uWaitingForPay":"uWaitingForPay","uPaid":"uPaid"},c={"uSubmited":"uSubmited","pNoticedUser":"pNoticedUser","uReceived":"uReceived","uReturned":"uReturned","pConfirmReturned":"pConfirmReturned"}):(l={"uSubmited":"用户已提交","pReceived":"平台确认收到机器","pEvaluated":"平台已评估","uConfirmed":"用户已确认","pRepairing":"平台维修中","pRepaired":"平台维修完成待领取","uReceived":"用户已领取","uWaitingForPay":"待用户支付费用","uPaid":"用户已支付"},c={"uSubmited":"用户已提交申请","pNoticedUser":"已通知用户领取备用机","uReceived":"用户已领取","uReturned":"用户已归还","pConfirmReturned":"平台确认用户已归还"}),$(".orderNav li").click(function(){h($(this).index())});var m=GetRequest();m.nav&&h(parseInt(m.nav)),$(".forMe").click(function(){null==d.questionnaire_option_id_group?location.href="questionnaire.html":location.href="recommendForMe.html"})});