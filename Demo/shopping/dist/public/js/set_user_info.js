$(function(){login()||(location.href="login.html"),$(".switch label").on("click",function(){var e=$(this).attr("class"),a=$(this).siblings("input");"switch_on"==e?(a.attr("checked",!1),a.attr("dataName","n"),$(this).attr("class","switch_off")):(a.attr("checked",!0),a.attr("dataName","y"),$(this).attr("class","switch_on"))});var t,c=getCookie("token"),i=api.getUser(c);$.ajax({"type":"GET","url":url+"/api/v1/school-region/index?school_id="+i.school_id+"&lang="+i18nLanguage+"&city="+getCookie("city"),"dataType":"json","async":!1,"success":function(e){if(200===e.code){var a=e.data;$("#schoolSearch").html(""),a.forEach(function(e,a){var t='<option value="'+e.id+'">'+e.name+"</option>";$("#schoolSearch").append(t)})}},"error":function(){}}),api.getAddressList(getCookie("userId")).forEach(function(e,a){"y"===e.is_default&&(t=e.address)}),$(".defalutAddress span").html(t),$('.sex[value="'+i.sex+'"]').attr("checked","true"),$('.role[value="'+i.type+'"]').attr("checked","true"),$(".name").val(i.name),$(".no").val(i.school_no),$("#schoolSearch").find('option[value="'+i.school_region_id+'"]').attr("selected",!0),"y"===i.order_email_notify?($("#check-1").attr("checked",!0),$("#check-1").attr("dataName","y"),$("#check-1").siblings("label").attr("class","switch_on")):($("#check-1").attr("checked",!1),$("#check-1").attr("dataName","n"),$("#check-1").siblings("label").attr("class","switch_off")),"y"===i.order_sms_notify?($("#check-2").attr("checked",!0),$("#check-2").attr("dataName","y"),$("#check-2").siblings("label").attr("class","switch_on")):($("#check-2").attr("checked",!1),$("#check-2").attr("dataName","n"),$("#check-2").siblings("label").attr("class","switch_off")),"phone"===i.verify_type?($(".phone").parent().hide(),$(".email").val(i.email)):($(".email").parent().hide(),$(".phone").val(i.phone)),$(".submit").click(function(){var a=i.school_region_id,o={"token":c,"id":i.id,"name":$(".name").val(),"sex":$('.sex[name="sex"]:checked').val(),"type":$('.role[name="role"]:checked').val(),"school_region_id":$("#schoolSearch").children("option:selected").val(),"order_email_notify":$("#check-1").attr("dataName"),"order_sms_notify":$("#check-2").attr("dataName"),"school_no":$(".no").val(),"default_address":$(".defalutAddress span").html()};"phone"===i.verify_type&&$(".email").val()!==i.email&&(o.email=$(".email").val()),"email"===i.verify_type&&$(".phone").val()!==i.phone&&(o.phone=$(".phone").val()),$.ajax({"type":"POST","url":url+"/api/v1/user/update","dataType":"json","data":o,"success":function(e){var t;200===e.code?a!==parseInt(o.school_region_id)?(api.getAddressList(getCookie("userId")).forEach(function(e,a){"y"===e.is_from_school&&(t=e.id)}),i=api.getUser(c),$.ajax({"type":"POST","url":url+"/api/v1/address/update","dataType":"json","data":{"token":c,"id":t,"address":i.school_info.name+" "+i.school_region_info.name,"is_from_school":"y"},"success":function(e){200===e.code&&(isEnglish()?$(".error").html("Successfully modified."):$(".error").html("修改成功。"),setTimeout(function(){location.href="center.html"},1e3))},"error":function(e,a,t){}})):(isEnglish()?$(".error").html("Successfully modified."):$(".error").html("修改成功。"),setTimeout(function(){location.href="center.html"},1e3)):$(".error").html(e.msg)},"error":function(e,a,t){}})})});