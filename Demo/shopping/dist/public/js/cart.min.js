$(function(){login()||(location.href="login.html");getCookie("token");$(".cartDetail table").on("click",'input[name="selectAll"]',function(){$(this).is(":checked")?$('input[name="select"]').each(function(){$(this).prop("checked",!0)}):$('input[name="select"]').each(function(){$(this).prop("checked",!1)})});var i=[];function n(){var a=0,n=[];i=[],$("input[name='select']:checked").each(function(){var t={"title":$(this).parent().parent().find(".title").html(),"price":parseFloat($(this).parent().parent().find(".price em").html())},e={"sku_id":$(this).val(),"quantity":$(this).parent().parent().find("#quantity").val()};n.push(t),i.push(e),a+=t.price}),$(".Clearing .all em").html(a.toFixed(2)),$(".Clearing .amount em").html(n.length),0===n.length&&($(".Clearing .all em").html("0.00"),$('.cartDetail input[name="selectAll"]').prop("checked",!1))}$(".cartDetail table").on("click",'input[type="checkbox"]',function(){n()});var s=[];function e(t){$(".cart .count").html(t.length),$(".cartDetail table").html("");$(".cartDetail table").append('<tr>\n                <th><input type="checkbox" name="selectAll">全选</th>\n                <th>商品</th>\n                <th class="td3">数量</th>\n                <th>小计</th>\n                <th>操作</th>\n            </tr>'),t.forEach(function(t,e){var a=(t.sku_info.school_price*t.quantity).toFixed(2);s.in_array(t.sku_info.goods_id)||s.push(t.sku_info.goods_id);var n='<tr class="skuId">\n                <td><input type="checkbox" name="select" data-name="'+t.id+'" value="'+t.sku_id+'"></td>\n                <td>\n                    <a href="./product.html?id='+t.sku_info.goods_id+'">                    <div class="img"><img src="'+t.sku_info.img_infos[0].url+'" alt=""></div>\n                    <div class="con">\n                        <p class="title">'+t.sku_info.goods_name+'</p>\n                        <span class="unit_price">￥<em>'+t.sku_info.school_price+'</em></span>\n                        <div class="amountM btnNum">                           <input type="button" value="-" class="less">                           <input type="text" value="'+t.quantity+'" class="text" id="quantity" data-name="'+t.id+'">                           <input type="button" value="+" class="plus">\n                        </div>                    </div>\n                    </a>                </td>\n                <td class="td3 btnNum">\n                    <input type="button" value="-" class="less">                    <input type="text" value="'+t.quantity+'" class="text" id="quantity" data-name="'+t.id+'">                    <input type="button" value="+" class="plus">                </td>\n                <td class="price">￥<em>'+a+'</em></td>\n                <td class="operate">\n                    <a href="javascript:;" id="delete" data-name="'+t.id+'">删除</a>\n                </td>\n            </tr>';$(".cartDetail table").append(n)})}api.getCartList(getCookie("userId"),i18nLanguage,e),$(".btnNum").on("click",".less",function(){var t=$(this).parent().find(".text").val(),e=$(this).parent().find(".text").attr("data-name");if(1<t&&(t--,$(this).parentsUntil("table",".skuId").find("#quantity").attr("value",t),$(this).parent().find("#quantity").attr("value",t),200===api.getCartUpdate(e,t).code)){var a=(parseFloat($(this).parentsUntil("table",".skuId").find(".unit_price em").html())*t).toFixed(2);$(this).parentsUntil("table",".skuId").find(".price em").html(a),n()}}),$(".btnNum").on("click",".plus",function(){var t=$(this).parent().find(".text").val(),e=$(this).parent().find(".text").attr("data-name");if(t++,$(this).parentsUntil("table",".skuId").find("#quantity").attr("value",t),$(this).parent().find("#quantity").attr("value",t),200===api.getCartUpdate(e,t).code){var a=(parseFloat($(this).parentsUntil("table",".skuId").find(".unit_price em").html())*t).toFixed(2);$(this).parentsUntil("table",".skuId").find(".price em").html(a),n()}}),$(".cartDetail table").on("click","#delete",function(){var t=$(this).attr("data-name");if(200===api.getCartDelete(t).code){$(this).parent().parent().remove();var e=parseFloat($(".cart .count").html());$(".cart .count").html(e-1),n()}}),$("#settle").click(function(){if(0===i.length)$(".error").html("请选择商品下单");else{$(".error").html("");var a="";i.forEach(function(t,e){a+=0===e?"goods"+e+"="+t.sku_id+"_"+t.quantity:"&goods"+e+"="+t.sku_id+"_"+t.quantity}),location.href="submitOrder.html?"+a}}),api.getRecommendAccessoryForGoods(s,0,1,20,"%2Bsale",i18nLanguage).data.forEach(function(t,e){var a='<li>\n                    <a href="./product.html?id='+t.id+'">                    <img src="'+t.img_infos[0].url+'" alt=""></a>\n                    <div class="con">\n                        <p class="Title">'+t.name+'</p>\n                        <p class="description">'+t.summary+'</p>\n                        <p class="price"><span>常规价格：</span>\n                            <del>￥'+t.price+'</del>\n                        </p>\n                        <p class="price"><span>学校优惠价：</span><em>￥'+t.school_price+'</em></p>\n                        <a class="apply" href="javascript:;" data-name="'+t.sku_infos[0].id+'">加入购物车</a>\n                    </div>\n                </li>';$(".recommend ul").append(a)}),$(".recommend .content").on("click",".apply",function(){var t=$(this).attr("data-name");200===api.getCartCreate(getCookie("userId"),t,1).code&&($(".zhezhao").show(),$(".tan2 .con p").html("加入购物车成功"),$(".tan2").show(),api.getCartList(getCookie("userId"),i18nLanguage,e),setTimeout(function(){$(".zhezhao").hide(),$(".tan2").hide()},1e3))})});