$(function(){login()||(location.href="login.html");getCookie("token");$('.cartDetail input[name="selectAll"]').click(function(){$(this).is(":checked")?$('input[name="select"]').each(function(){$(this).prop("checked",!0)}):$('input[name="select"]').each(function(){$(this).prop("checked",!1)})});function n(){var a=0,n=[],i=[];$("input[name='select']:checked").each(function(){var t={"title":$(this).parent().parent().find(".title").html(),"price":parseFloat($(this).parent().parent().find(".price em").html())},e={"sku_id":$(this).val(),"quantity":$(this).parent().parent().find("#quantity").val()};n.push(t),i.push(e)}),n.forEach(function(t,e){a+=t.price,$(".Clearing .all em").html(a.toFixed(2))}),$(".Clearing .amount em").html(n.length),0===n.length&&($(".Clearing .all em").html("0.00"),$('.cartDetail input[name="selectAll"]').prop("checked",!1))}$(".cartDetail table").on("click",'input[type="checkbox"]',function(){n()});var t=api.getCartList(getCookie("userId"),i18nLanguage);api.getCartInfo(1,i18nLanguage);t.forEach(function(t,e){var a=(t.sku_info.school_price*t.quantity).toFixed(2),n='<tr class="skuId">\n                <td><input type="checkbox" name="select" data-name="'+t.id+'" value="'+t.sku_id+'"></td>\n                <td>\n                    <div class="img"><img src="../public/img/order.png" alt=""></div>\n                    <div class="con">\n                        <p class="title">'+t.name+'</p>\n                        <span class="unit_price">￥<em>'+t.sku_info.school_price+'</em></span>\n                        <div class="amountM btnNum">                           <input type="button" value="-" class="less">                           <input type="text" value="'+t.quantity+'" class="text" id="quantity" data-name="'+t.id+'">                           <input type="button" value="+" class="plus">\n                        </div>                    </div>\n                </td>\n                <td class="td3 btnNum">\n                    <input type="button" value="-" class="less">                    <input type="text" value="'+t.quantity+'" class="text" id="quantity" data-name="'+t.id+'">                    <input type="button" value="+" class="plus">                </td>\n                <td class="price">￥<em>'+a+'</em></td>\n                <td class="operate">\n                    <a href="javascript:;" id="delete" data-name="'+t.id+'">删除</a>\n                </td>\n            </tr>';$(".cartDetail table").append(n)}),$(".btnNum").on("click",".less",function(){var t=$(this).parent().find(".text").val(),e=$(this).parent().find(".text").attr("data-name");if(1<t&&(t--,$(this).parentsUntil("table",".skuId").find("#quantity").attr("value",t),$(this).parent().find("#quantity").attr("value",t),200===api.getCartUpdate(e,t).code)){var a=(parseFloat($(this).parentsUntil("table",".skuId").find(".unit_price em").html())*t).toFixed(2);$(this).parentsUntil("table",".skuId").find(".price em").html(a),n()}}),$(".btnNum").on("click",".plus",function(){var t=$(this).parent().find(".text").val(),e=$(this).parent().find(".text").attr("data-name");if(t++,$(this).parentsUntil("table",".skuId").find("#quantity").attr("value",t),$(this).parent().find("#quantity").attr("value",t),200===api.getCartUpdate(e,t).code){var a=(parseFloat($(this).parentsUntil("table",".skuId").find(".unit_price em").html())*t).toFixed(2);$(this).parentsUntil("table",".skuId").find(".price em").html(a),n()}})});