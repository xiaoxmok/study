$(function(){var a=getCookie("token"),t=GetRequest(),i=api.getGoods(t.id,i18nLanguage);$("#name").html(i.name),$("#summary").html(i.summary);var e=api.getSkuList(i.id,i18nLanguage),n=e.data,o=e.extra.param;function s(a){var t;999===a?(t=i.img_infos,a=0):0===(t=n[a].img_infos).length&&(t=i.img_infos),$(".swiper-wrapper").html(""),$(".product .small").html(""),t.forEach(function(a,t){var e='<div class="swiper-slide"><img src="'+a.url+'" alt=""></div>';$(".swiper-wrapper").append(e);var i='<a href="javascript:;" class="link"  data-name="'+t+'"><img src="'+a.url+'" alt=""></a>';$(".product .small").append(i)}),$("#price").html(toPrice(n[a].price)),login()?($("#school_price").html(toPrice(n[a].school_price)),$(".exclusive").hide(),isEnglish()?$(".OfferPrice").html("Exclusive offer"):$(".OfferPrice").html("专属优惠")):$("#school_price").html(toPrice(n[a].education_price));var e=new Swiper(".swiper-container",{"speed":1e3,"autoplay":{"delay":3e3},"loop":!0,"pagination":{"el":".swiper-pagination"}});$(".small").on("click",".link",function(){var a=parseInt($(this).attr("data-name"))+1;e.slideTo(a,1e3,!1)})}$(".introduce").html(i.introduce),s(999);var l=n[0].id,c=[{"sku_id":l,"quantity":$("#quantity").val()}];for(var r in o)if(void 0!==o[r].value){var h;o[r].value.forEach(function(a,t){0===t?h='<a href="javascript:;" data-name="'+r+'" class="active">'+a+"</a>":h+='<a href="javascript:;" data-name="'+r+'">'+a+"</a>"});var u='<tr>\n                        <td class="td1">'+o[r].name+'：</td>\n                        <td class="td2 '+r+'">\n'+h+"                        </td>\n                    </tr>";$(".param").append(u)}function p(a){$(".zhezhao").show(),$(".tan2 .con p").html(a),$(".tan2").show(),setTimeout(function(){$(".zhezhao").hide(),$(".tan2").hide()},1e3)}$(".param .td2").on("click","a",function(){$(this).parent().find("a").removeClass("active"),$(this).addClass("active");var e={},i=0;for(var i in o)void 0!==o[i].value&&(e[i]=$("."+i).find(".active").html());n.forEach(function(a,t){isEqual(a.param_value,e)&&(l=a.id,i=t)}),s(i),c=[{"sku_id":l,"quantity":$("#quantity").val()}]}),$(".add").click(function(){if(login()){a=$("#quantity").val();console.log("quantity",a),200===api.getCartCreate(getCookie("userId"),l,a).code&&($(".zhezhao").show(),isEnglish()?$(".tan2 .con p").html("Add to Cart successful."):$(".tan2 .con p").html("加入购物车成功。"),$(".tan2").show(),api.getCartList(getCookie("userId"),i18nLanguage,function(a){var e=0;a.forEach(function(a,t){e+=a.quantity}),$(".cart .count").html(e)}),setTimeout(function(){$(".zhezhao").hide(),$(".tan2").hide()},1e3))}else{var a=$("#quantity").val();console.log(l,a);var e,i,t=[],n=!0;if(getCookie("localCart"))(t=getCookie("localCart").split(",")).forEach(function(a,t){a.split("-")[0]==l&&(n=!1,e=t,i=a.split("-"))}),n?t.push(l+"-"+a):t.splice(e,1,l+"-"+(parseInt(a)+parseInt(i[1]))),getCookie("localCart",t,{"expires":30,"path":"/"}),isEnglish()?p("Join the temporary shopping cart successfully!"):p("加入临时购物车成功！");else t.push(l+"-"+a),getCookie("localCart",t,{"expires":30,"path":"/"}),isEnglish()?p("Join the temporary shopping cart successfully!"):p("加入临时购物车成功！");if(getCookie("localCart")){var o=getCookie("localCart").split(","),s=0;o.forEach(function(a,t){var e=a.split("-");s+=parseInt(e[1])}),$(".cart .count").html(s)}}}),$(".buy").click(function(){if(login()){var e="";c.forEach(function(a,t){e+=0===t?"goods"+t+"="+a.sku_id+"_"+a.quantity:"&goods"+t+"="+a.sku_id+"_"+a.quantity}),location.href="submitOrder.html?"+e}else $(".zhezhao").show(),isEnglish()?$(".tan2 .con p").html("please sign in...."):$(".tan2 .con p").html("请登录。。。"),$(".tan2").show(),setTimeout(function(){$(".zhezhao").hide(),$(".tan2").hide(),location.href="login.html"},1e3)}),"y"===i.is_fav?isEnglish()?$(".collect").html('<span class="marked"></span>collected'):$(".collect").html('<span class="marked"></span>已收藏'):isEnglish()?$(".collect").html('<span class="unmark"></span>Collection'):$(".collect").html('<span class="unmark"></span>收藏'),$(".collect").click(function(){login()?"y"===api.getGoods(t.id,i18nLanguage).is_fav?$.ajax({"type":"get","url":url+"/api/v1/fav/delete?token="+a+"&goods_id="+t.id,"dataType":"json","success":function(a){200===a.code&&($(".zhezhao").show(),isEnglish()?($(".tan2 .con p").html("Cancel collection success."),$(".collect").html('<span class="unmark"></span>Collection')):($(".tan2 .con p").html("取消收藏成功。"),$(".collect").html('<span class="unmark"></span>收藏')),$(".tan2").show(),setTimeout(function(){$(".zhezhao").hide(),$(".tan2").hide()},1e3))},"error":function(){}}):$.ajax({"type":"POST","url":url+"/api/v1/fav/create","dataType":"json","data":{"token":a,"goods_id":t.id},"success":function(a){200===a.code&&($(".zhezhao").show(),isEnglish()?($(".tan2 .con p").html("Collection success."),$(".collect").html('<span class="marked"></span>collected')):($(".tan2 .con p").html("收藏成功。"),$(".collect").html('<span class="marked"></span>已收藏')),$(".tan2").show(),setTimeout(function(){$(".zhezhao").hide(),$(".tan2").hide()},1e3))},"error":function(){}}):($(".zhezhao").show(),isEnglish()?$(".tan2 .con p").html("please sign in."):$(".tan2 .con p").html("请登录。"),$(".tan2").show(),setTimeout(function(){$(".zhezhao").hide(),$(".tan2").hide()},1e3))}),$(".contact ").click(function(){$(".zhezhao").show(),$(".tan1").show()}),$(".cls ").click(function(){$(".zhezhao").hide(),$(".tan1").hide()});var d=$(".btnNum .text").val();$(".btnNum .less").click(function(){1<d&&(d--,$(".btnNum .text").attr("value",d)),c=[{"sku_id":l,"quantity":$("#quantity").val()}]}),$(".btnNum .plus").click(function(){d++,$(".btnNum .text").attr("value",d),c=[{"sku_id":l,"quantity":$("#quantity").val()}]}),$(".productNav li").click(function(){var a=$(this).index();$(".productDetail").hide().eq(a).show(),$(".productNav li").removeClass("active"),$(this).addClass("active")})});